<div *ngIf="(checkin$ | async) as checkin; else loader">
  <mat-card *ngIf="!editing">
    <mat-card-header>
      <div mat-card-avatar class="header-image"></div>
      <mat-card-title>{{ checkin.geocache.location.lat }}, {{ checkin.geocache.location.lng}}</mat-card-title>
      <mat-card-subtitle>{{ checkin.created_at | date }}</mat-card-subtitle>
    </mat-card-header>

    <app-secure-image *ngIf="null !== checkin.image"
                      [image]="checkin.image"></app-secure-image>
    <mat-card-content>
      <p>
        {{ checkin.text }}
      </p>
    </mat-card-content>
    <mat-card-actions>
      <button mat-button
              (click)="editing = true">Edit</button>
    </mat-card-actions>
  </mat-card>

  <mat-card *ngIf="editing">
    <mat-card-header>
      <div mat-card-avatar class="header-image"></div>
      <mat-card-title>{{ checkin.geocache.location.lat }}, {{ checkin.geocache.location.lng}}</mat-card-title>
      <mat-card-subtitle>{{ checkin.created_at | date }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="updateForm">
        <mat-form-field style="width: 100%;">
          <textarea formControlName="text"
                    matInput
                    placeholder="Comment"></textarea>
        </mat-form-field>
      </form>
    </mat-card-content>
    <mat-card-actions>
      <button mat-button
              (click)="updateCheckin()">Submit</button>
      <button mat-button
              (click)="editing = false">Cancel</button>
    </mat-card-actions>
  </mat-card>
</div>

<ng-template #loader>
  <mat-card>
    <mat-progress-bar
      color="primary"
      mode="indeterminate">
    </mat-progress-bar>
  </mat-card>
</ng-template>
